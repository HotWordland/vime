import { Meta } from '@storybook/addon-docs/blocks';
import LinkTo from "@storybook/addon-links/react";

<Meta title="Packages/Player/Plugins/Controls/Controls" />

# Controls `Plugin`

[View Source](https://github.com/vime-js/vime/blob/master/packages/vime-player/src/plugins/controls/Controls.svelte)

**ID:** `vControls`

**ROLE:** `CONTROLS`

This plugin renders and manages control groups (see <LinkTo kind="packages-player-plugins-controls-controlgroup">Controls/ControlGroup</LinkTo>).

💡 To see this plugin in action then go to 'Player/Components'.

📝 This plugin has a `Registry` that can be accessed through the root registry under the `ID` listed above.

## Default Controls

By default there are no groups/controls, but you can install an additional `DefaultControls` plugin to 
get started with the Vime defaults.

The default controls depend on:

- Whether the player is playing an audio track or video.
- Whether it is a mobile device or not.
- Whether it is a live stream or not.

You can play around in 'Player/Components' to see each mode.

## Setup

### `plugins`

```js
import { Controls, DefaultControls } from '@vime-js/player';

player.plugins = [Controls, DefaultControls];
```

### `PluginsManager`

```js
import { Controls, DefaultControls } from '@vime-js/player';

player
  .getPluginsManager()
  .addPlugins([Controls, DefaultControls])
  .then(([controls]) => {
    // ...
  });
```

## Usage

### Create Group

```js
import { PlaybackControl, VolumeControl, ScrubberControl } from '@vime-js/player';

player
  .vControls
  .createGroup('lowerGroup')
  .then(controlGroup => {
    // $set is part of the Svelte component API, you can individually set these props as well.
    controlGroup.$set({
      controls: [PlaybackControl, VolumeControl, ScrubberControl],
      shouldFill: true,
      position: 'flex-end:flex-start'
    });
  });
```

### Update Group

See <LinkTo kind="packages-player-plugins-controls-controlgroup">Controls/ControlGroup</LinkTo> for
the full API.

```js
const controlGroup = player.vControls.getGroup('lowerGroup');
controlGroup.isActive = true;
```

### Delete Group

```js
player
  .vControls
  .removeGroup('lowerGroup')
  .then(() => {
    // ...
  });
```

### Access Group via Event

```js
player.vControls.$on('register', registration => {
  const { id, value: controlGroup } = registration;
  if (id === 'lowerGroup') {
    // ...
  }
});
```

### Access Group via Registry

```js
player.vControls.getRegistry().subscribe(groups => {
  const controlGroup = groups.lowerGroup;
  if (controlGroup) {
    // ...
  }
});
```

## Methods

### `getEl(): HTMLElement`

The root HTML element of this plugin.

### `getRegistry(): Registry`

The plugin registry where `ControlGroup` instances are registered (see <LinkTo kind="api-registry--page">API/Registry</LinkTo>).

### `getGroups(): { [id]: ControlGroup }`

The rendered `ControlGroup` instances.

### `getGroup(id: string): ControlGroup|undefined `

The rendered `ControlGroup` instance for the given `id`.

### `createGroup(id: string): Promise<ControlGroup>`

Creates and renders a `ControlGroup` component and returns a `Promise` that will resolve with the 
rendered instance.

### `createGroups(ids: string[]): Promise<ControlGroup[]>`

Creates and renders a list of `ControlGroup` components and returns all their instances via a `Promise`.

### `removeGroup(id: string): Promise<undefined>`

Destroys a `ControlGroup` instance matching the given `id` and returns a `Promise` that will resolve
once it has completed.

### `removeGroups(ids: string[]): Promise<undefined>`

Destroys multiple `ControlGroup` instances matching the given `ids` and returns a `Promise` that will
resolve once it has completed.

## Events

See <LinkTo kind="api-registry--page#events">API/Registry - Events.</LinkTo>