import { Meta } from "@storybook/addon-docs/blocks";
import LinkTo from "@storybook/addon-links/react";

<Meta title="Packages/Player/Getting Started" />

<img
  width="300px"
  alt="vime"
  src="/brand/vime-player--dark.svg"
/>

<br/>

[![version-badge]][package]
[![size-badge]][size]
[![license-badge]][license]
[![github-badge]][github]
[![tweet-badge]][tweet]

[package]: https://www.npmjs.com/package/@vime-js/player
[version-badge]: https://img.shields.io/npm/v/@vime-js/player?style=flat-square
[size]: https://bundlephobia.com/result?p=@vime-js/player
[size-badge]: https://img.shields.io/bundlephobia/minzip/@vime-js/player?label=min%2Bgzip
[license]: https://github.com/vime-js/vime/blob/master/LICENSE
[license-badge]: https://img.shields.io/github/license/vime-js/vime?color=blue&style=flat-square
[tweet]: https://twitter.com/intent/tweet?text=Check%20out%20Vime%20%28https%3A%2F%2Fgithub.com%2Fvime-js%2Fvime%29%2C%20it%20makes%20embedding%20and%20using%20media%20players%20for%20the%20web%20simple.%20It%20supports%20Html5%2C%20YouTube%2C%20Dailymotion%2C%20Vimeo%20and%20more%20to%20come%21
[tweet-badge]: https://img.shields.io/twitter/url?style=social&url=https%3A%2F%2Fgithub.com%2Fvime-js%2Fvime
[github]: https://github.com/vime-js/vime
[github-badge]: https://img.shields.io/github/stars/vime-js/vime?style=social

## Table of Contents

- [Installation](#installation)
- [Setup](#setup)
  - [JavaScript](#javascript)
  - [Svelte](#svelte)
- [Loading Providers](#loading-providers)
- [Loading Plugins](#loading-plugins)
- [Loading Icons](#loading-icons)
- [Extending Language](#extending-language)
- [Theming](#theming)
- [Props](#props)
- [Store](#store)
- [Methods](#methods)
- [Events](#events)
- [Examples](#examples)

## Installation

This package contains the **Complete** player. If you'd like to know what features the Complete player includes
then see <LinkTo kind="overview-getting-started--page">Overview/Getting Started</LinkTo>.

**NPM:** `npm install @vime-js/player`

**YARN:** `yarn add @vime-js/player`

**UNPKG:** `https://unpkg.com/@vime-js/player`

The `dist` folder inside the package contains multiple exports:

- `player.js` is a UMD development build that can be used directly in the browser via the `<script>` tag.
- `player.esm.js` is intended for use with modern bundlers like [Webpack](https://webpack.js.org/) or [Rollup](http://rollupjs.org/guide/en/).
- `player.min.js` is a UMD production build that can be used directly in the browser via the `<script>` tag.
- `player.esm.min.js` is an ESM production build that can be used directly in modern browsers via the `<script type="module">` tag.

üìù UMD builds are exported under the `Vime` namespace.

üìù If you're using a bundler then it will automatically pull in the correct files.

üìù If you're using [svelte-loader](https://github.com/sveltejs/svelte-loader) or [rollup-plugin-svelte](https://github.com/sveltejs/rollup-plugin-svelte) then you'll receive the uncompiled components.

## Setup

### JavaScript

```js
import { Player } from '@vime-js/player';

// Mount
const target = document.getElementById('player-target');

const player = new Player({ 
  target,
  // If you'd like to initialize any props on setup, you can do so here.
  props: {}
});

// ...

// Destroy
player.$destroy();
```

üìù See the Svelte [Client-side component API](https://svelte.dev/docs#Client-side_component_API) for the complete set of component initialization options.

### Svelte

```html
<Player
  on:mount={onPlayerMount}
  bind:this={player} 
/>

<script>
  import { Player } from '@vime-js/player';

  let player;

  const onPlayerMount = () => {
    // If you need to call any methods, you have access to the player instance here.
  };
</script>
```

## Loading Providers

Providers are loaded via the `providers` prop.

```js
// All providers are named {ProviderName}Provider.
import { Player, Html5Provider, YouTubeProvider } from '@vime-js/player';

// ...

const player = new Player({ 
  target,
  props: {
    providers: [Html5Provider, YouTubeProvider]
  }
});
```

## Loading Plugins

Plugins are loaded via the `plugins` prop, for more information 
see <LinkTo kind="packages-player-plugins-introduction-getting-started--page">Plugins/Getting Started</LinkTo>.

```js
import { Player, Boot } from '@vime-js/player';

// ...

const player = new Player({ 
  target,
  props: {
    // The Boot plugin installs all Vime plugins.
    plugins: [Boot]
  }
});
```

## Loading Icons

Icons are set via the `icons` prop. 

### Vime Icons

You can load the default Vime icons by using the `Icons` plugin.

```js
import { Icons } from '@vime-js/player';

// If you're using the Boot plugin, it already loads this for you.
player.plugins = [Icons];
```

### Custom Icons

Create an SVG sprite and insert it into the head of the document. You can then override the 
following default icons.

- play
- pause
- captionsOn
- captionsOff
- enterFullscreen
- exitFullscreen
- enterPiP
- exitPiP
- seekForward
- seekBackward
- volumeLow
- volumeHigh
- volumeMute
- settings
- checkmark

```js
// Using custom play icon.
player.icons = { ...player.icons, play: '#play-svg-id' };
```

## Extending Language

You can add your own language via the `languages` prop, see our [english map](https://github.com/vime-js/vime/blob/master/packages/vime-player/src/lang/en.js)
as an example.

```js
// Add the language.
player.languages = {
  ...player.languages,
  zh: {
    // From Google Translate.
    play: 'Êí≠ÊîæËßÜÈ¢ë',
    pause: 'ÊöÇÂÅúÂΩ±Áâá',
    // ...
  }
};

// Change the locale.
player.locale = 'zh';
```

### Theming

You can style the player via the `theme` prop. Under the hood it utilizes [CSS custom properties](https://developer.mozilla.org/en-US/docs/Web/CSS/--*).

**Available Properties:**

- color
- fontFamily
- fontSizeSmall
- fontSizeMedium
- fontSizeLarge
- fontSizeExtraLarge
- fontWeightLight
- fontWeightRegular
- fontWeighBold
- baseLineHeight

**Example**

```js
// Apply a simple color theme.
player.theme = '#f76d82';

// Advanced theming.
player.theme = {
  color: '#f76d82',
  fontFamily: '"Helvetica Neue", "Segoe UI", Helvetica, Arial, sans-serif',
  fontSizeSmall: '14px',
  fontSizeMedium: '16px',
  fontSizeLarge: '18px',
  fontSizeExtraLarge: '21px',
  fontWeightLight: '300',
  fontWeightRegular: '400',
  fontWeightBold: '500',
  baseLineHeight: '1.7'
}
```

## Props

The `Player` component extends the Vime player interface, see <LinkTo kind="api-player--page">API/Player</LinkTo> for additional props.

- `useNativeView`, `useNativeControls` and `useNativeCaptions` default to `false`.
- `canSetPoster`, `canSetTracks` and `canSetTrack` now check for both plugin and provider support.

### `locale: string`

**Default:** `en`

Determines the current language preference.

### `languages: { [localeId]: { [id]: string } }`

**Default:** `{ en: { [id]: string } }`

Translation maps that the player uses when the `locale` changes.

### `i18n: { [id]: string }`

**Default:** `en` language map.

Contains the current language map. It's basically `languages[locale]` under the hood. If the current 
`locale` has no language map, it'll fallback to `en`.

### `icons: { [id]: string }`

**Default:** `{}`

Icons are expected to be loaded as an SVG sprite that is inserted into the head of the document. The 
`icons` prop is a list of keys that point to SVG `id` tags.

### `theme: string|object|null`

**Default:** `null`

Used to style the player, under the hood it uses CSS custom properties.

### `class: string`

**Default:** `null`

CSS classes to be applied to the root player element.

### `providers: Provider[]`

**Default:** `[]`

The current list of providers. 

### `plugins: Plugin[]`

**Default:** `[]`

The current list of plugins.

### `Provider: object|null`

**Default:** `null`

The current provider module who can play the current `src`.

### `debug: boolean`

**Default:** `false`

Whether the player is in debug mode or not. If `true`, messages are sent to the console.

### `isMobile: boolean`

**Default:** `true` if the device is determined to be a mobile device via the User-Agent.

Whether the player is in mobile mode or not.

### `isTouch: boolean` `(readonly)`

**Default:** `false`

Whether the user is currently using touch input. This is actively updated by listening to the `touchstart` 
and `mousemove` event.

### `isContextMenuEnabled: boolean`

**Default:** `false`

Whether the context menu (right click on player) can be opened or not. In development mode this is 
enabled regardless of what value this is set to.

### `currentPoster: string|null` `(readonly)`

**Default:** `null`

The current poster, either a custom poster or the native one if available.

### `hasControls: boolean` `(readonly)`

**Default:** `false`

Whether there are controls available via a plugin, or the native controls are being used.

### `hasCaptions: boolean` `(readonly)`

**Default:** `false`

Whether there are captions available via a plugin, or the native captions are being used.

### `hasSettings: boolean` `(readonly)`

**Default:** `false`

Whether settings are available via a plugin, or the native controls are being used and have
settings available.

## Store

In addition to the props listed in <LinkTo kind="api-player--page">API/Player</LinkTo>, 
all the properties listed above are now also available in the store.

```js
const { locale } = player.getStore();

const unsubscribe = locale.subscribe(newLocale => {
  console.log('current locale is', newLocale);
});

// ...

unsubscribe();
```

## Methods

The `Player` component extends the Vime player interface, see <LinkTo kind="api-player--page#methods">API/Player</LinkTo> for additional methods.

### `getEl(): HTMLElement`

The root player element.

### `getRegistry(): Registry`

The root player registry (see <LinkTo kind="api-registry--page">API/Registry</LinkTo>).

### `getPluginsManager(): PluginsManager`

The core `PluginsManager` (see <LinkTo kind="api-pluginsmanager--page">API/PluginsManager</LinkTo>).

### `getPluginsRegistry(): Registry`

The `Registry` used by the `PluginsManager`. Alternative to `player.getPluginsManager().getRegistry()`.

### `dispose(cb: () => void)`

Calls the provided cleanup `function` when the player is being destroyed.

### `createRegistry(id: string): Registry`

Creates a new `Registry`, registers it with the root player registry and returns it. This method 
is generally used by plugins.

### `createLogger(id: string): object`

Returns an object with a `log`, `warn` and `error` function that formats and forwards messages to the 
respective `console` method. This method is generally used by plugins.

## Events

```js
// Start listening.
const off = player.$on("someEvent", e => {
  const data = e.detail;
});

// Stop listening.
off();
```

### `mount`

**Data Type:** `undefined`

Fired when the player has mounted the DOM.

### `destroy`

**Data Type:** `undefined`

Fired when the player is removed from the DOM.

### `pluginmount`

**Data Type:** `{ id: string, plugin: component }`

Fired when a plugin has mounted the DOM and attached to the player.

### `plugindestroy`

**Data Type:** `string`

Fired when a plugin has been destroyed, removed from the DOM and deattached from the player. Data
contains the `id` of the destroyed plugin.

### `error`

**Data Type:** `any`

Emits provider/plugin errors.

## Examples

For interactive examples go to 'Player/Components'.
